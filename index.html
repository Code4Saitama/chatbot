<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>recording</title>
</head>
<body>
　　　　<div style="display:flex;">
  　　　　<button id="recorder">Record</button>
  　　　　<audio id="player" controls></audio>
　　　　</div>
</body>
<script>
if (!navigator.mediaDevices) {
 alert("mediaDevices is unavailable");
}

var mediaRecorder = null;
var localstream;

// 録音開始
rec_start = function(){
  navigator.mediaDevices.getUserMedia({audio:true})
    .then(function(stream) {
      localstream = stream;
      mediaRecorder = new MediaRecorder(stream);
      mediaRecorder.start();
      console.log('record start')
    })
    .catch(function(e){
      console.log(e);
    });
}

// 録音停止
rec_stop = function(){
  console.log(mediaRecorder)
  mediaRecorder.stop();
  mediaRecorder.ondataavailable = function(e) {
    document.getElementById('player').src = URL.createObjectURL(e.data);
  }
  localstream.getTracks().forEach(track => track.stop());
}

document.getElementById('recorder').onclick = function(){
  // ボタンの色で録音開始、停止を切り替える
  if (this.style.backgroundColor == ''){
    rec_start();    // 開始
    console.log('rec_start')
    this.style.backgroundColor = '#c71585';
  } else {
    //rec_stop();     // 停止
    console.log('rec_stop')
    this.style.backgroundColor = '';

      mediaRecorder.stop();
  mediaRecorder.ondataavailable = function(e) {
    document.getElementById('player').src = URL.createObjectURL(e.data);
  }
  localstream.getTracks().forEach(track => track.stop());
  }
}
</script>

<br>

<input class="text" value="Web Speech API を使ってみよう！"/>
<button onclick="speak()">speak()</button>
<script>
function speak(){
  var text = document.querySelector('.text').value;
  speechSynthesis.speak(
    new SpeechSynthesisUtterance(text)
  );
}
</script>

</html>
